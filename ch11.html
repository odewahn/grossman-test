<section xmlns="http://www.w3.org/1999/xhtml" id="file_inputsolidusoutput" data-type="chapter" class="pagenumrestart"><h1>File Input/Output</h1><aside data-type="sidebar"><h5>In This Chapter</h5><ul><li><p>Reading files</p></li><li><p>Writing files</p></li></ul></aside><section id="one1dot1_introduction" data-type="sect1"><h1>11.1 Introduction</h1><p>Until this point, all of our programs have taken a data set of
    values from user input. Any given program took in one data set, which
    consisted of one or more related values from the user, and then performed
    a computation based on that data set. Imagine a program that has many data
    sets, each consisting of multiple values. Entering all the data sets by
    hand could be somewhat time-consuming. Also, some data sets may come from
    external sources and not directly from the user.</p><p>The techniques presented in this chapter will allow you to
    manipulate files and utilize their data within your software. File
    input/output (I/O) allows software to perform computations on sets of data
    until a desired end result is achieved.</p></section><section id="one1dot2_file_access_reading_and_writing" data-type="sect1"><h1>11.2 File Access: Reading and Writing</h1><p>To access files, the built-in Ruby <code>File</code> class is used. This class contains multiple
    methods. We use the following: <code>open</code>,
    <code>close</code>, <code>gets</code>, and <code>puts</code>. The method <code>File.open</code> instantiates a new object that enables
    Ruby to read from or write to an existing or new file. The object returned
    by <code>File.open</code> can then be used by Ruby
    to access the file. The following code shows how to open a file:</p><pre id="pro_id00066" data-type="programlisting" data-code-language="ruby">myfile = File.open(file_name, access_mode)</pre><p>The <code>myfile</code> variable is a <code>File</code> object that can now be used to interact
    with the file’s contents, depending on what access mode is used. Note that
    <code>file name</code> and <code>access mode</code> are strings. The variable <code>file_name</code> is a representation of a path to a
    file, such as <span class="keep-together"><code data-type="filename">/home/ruby/file.txt</code>.</span> The <code>myfile</code> variable in our program is local to only
    our program. Two of the most basic access modes and what they do are shown
    in <a href="#some_file_access_modes" data-type="xref"/>.</p><table id="some_file_access_modes"><caption>Some file access modes</caption><thead><tr><th>Mode</th><th>Description</th></tr></thead><tbody><tr><td><p><code>r</code></p></td><td><p>Read access only. Points to start of the
            file. This is the default, but it is good programming style to
            specify it anyway.</p></td></tr><tr><td><p><code>w</code></p></td><td><p>Write access only. Points to the
            beginning of the file that will overwrite the file’s content if it
            already exists.</p></td></tr></tbody></table><div id="ch11note01" data-type="note"><h1>Gem of Wisdom</h1><p>Files provide access to data resident in the computer system’s
      long-term memory. Storage in long-term memory, such as disks, provides
      data resiliency, namely, permanence. That is, disks work even without
      power, so they store things far longer than the internal random access
      memory, which works only if the power is on.</p></div><p>To read a line of characters from a file, call the <code>gets</code> method on the <code>myfile</code> object. When the <code>gets</code> method is called, it reads characters until
    it reaches a newline character (<code>\n</code>),
    and then it returns what it read. The <code>File</code> object keeps track of what has been read
    in, so each successive call to <code>gets</code>
    will always return the next line, until it reaches the end of the file and
    returns <code>nil</code>. <code>nil</code> has the logical truth value of <code>false</code>. Every other value returned by <code>gets</code> has the logical value of <code>true</code>. Consider the code provided in <a href="#sample_code_for_file_reading" data-type="xref"/>, which reads in a file <code data-type="filename">foo.txt</code> and then prints it out.</p><div id="sample_code_for_file_reading" data-type="example"><h5>Sample code for file reading</h5><pre data-type="programlisting" data-code-language="ruby">     1 myfile = File.open("foo.txt", "r")
     2 whole_file = ""
     3 
     4 while (input_line = myfile.gets)
     5 	whole_file += input_line
     6 end
     7 
     8 puts "Contents of input file:"
     9 puts whole_file
    10 myfile.close()
</pre></div><ul><li><p>Line 1 opens <code data-type="filename">foo.txt</code> for
        read access.</p></li><li><p>Line 2 instantiates an empty string variable, <code>whole_file</code>, which will be used to store the
        file to display.</p></li><li><p>Lines 4–6 contain a loop that reads the file into <code>input_line</code>, one line at a time, and appends
        each line into <code>whole_file</code>.</p></li><li><p>Line 9 prints out the file.</p></li></ul><p>Sequentially writing to a file is similar to sequentially reading
    from a file. Instead of opening the file in read mode, the file needs to
    be opened with <code>w</code> for writing access. To
    write text to a file, use the local variable <code>myfile</code> to call the <code>puts</code> method:</p><pre id="pro_id00067" data-type="programlisting" data-code-language="ruby">myfile.puts("text goes here!")</pre><p>The code shown in <a href="#file_readsoliduswrite_example" data-type="xref"/>
    opens a file for write access, accepts user input, and writes that input
    to the file. It will then close the file, reopen it, and print the
    contents to verify correctness.</p><div id="file_readsoliduswrite_example" data-type="example"><h5>File read/write example</h5><pre data-type="programlisting" data-code-language="ruby">     1 file_a = File.open("bar.txt", "w")
     2 
     3 puts "Please enter a line of text"
     4 line = gets()
     5 file_a.puts(line)
     6 file_a.close()
     7 
     8 file_b = File.open("bar.txt", "r")
     9 puts "Contents of file:"
    10 puts file_b.gets()
    11 file_b.close()
</pre></div><ul><li><p>Line 1 opens <code data-type="filename">bar.txt</code> as
        file object <code>file_a</code> with write
        access.</p></li><li><p>Lines 3–4 take text input from the user.</p></li><li><p>Line 5 writes the user input into <code>"bar.txt"</code>.</p></li><li><p>Line 6 closes the <code>File</code> object
        <code>file_a</code> (this saves the text inside
        it by closing the file and preventing further access to it).</p></li><li><p>Line 8 instantiates a new <code>File</code> object <code>file_b</code>. This object will be used for the
        purpose of reading the content of <code data-type="filename">bar.txt</code>. Note the file access mode <code>r</code>.</p></li><li><p>Line 10 outputs the contents of the newly created file to the
        console, illustrating that the code in <a href="#file_readsoliduswrite_example" data-type="xref"/> behaves in the desired
        fashion.</p></li></ul><section id="one1dot2dot1_file_reader_class" data-type="sect2"><h2>11.2.1 File Reader Class</h2><p>We will now define two classes that encapsulate reading in a file
      and writing out a file. Then we will use the two classes to create a
      file copy program that will read text from a file and then copy the text
      into a new file.</p><p>The class presented in <a href="#filereader_class" data-type="xref"/>
      encapsulates reading and displaying a file.</p><div id="filereader_class" data-type="example"><h5>FileReader class</h5><pre data-type="programlisting" data-code-language="ruby">     1 class FileReader
     2 
     3 	def initialize(file_name)
     4 		@file = File.open(file_name, "r")
     5 	end
     6 
     7 	def read_file
     8 		whole_file = ""
     9 		while (input_line = @file.gets)
    10 			whole_file += input_line
    11 		end
    12 
    13 		return whole_file
    14 	end
    15 
    16 	def display
    17 		puts "Contents of input file:"
    18 		puts read_file
    19 	end
    20 
    21 	def close
    22 		@file.close()
    23 	end
    24 end
</pre></div><ul><li><p>Lines 3–5 define the constructor. The variable <code>@file</code> references the <code>File</code> object that has been opened.</p></li><li><p>Line 4 opens the file for the purpose of reading the contents.
          The <code>r</code> indicates that this file is
          to be open for reading.</p></li><li><p>Lines 7–14 define the <code>read
          file</code> method. This method incorporates a basic loop that
          goes through a given file using <code>gets</code> for the purpose of reading one line
          at a time.</p></li><li><p>Line 10 appends (adds to the end of the string) to <code>whole_file</code> the contents of the currently
          read line of the file.</p></li><li><p>Line 13 returns the contents of the file that is now stored in
          <code>whole_file</code>.</p></li><li><p>Lines 16–19 define a display method that outputs the contents
          of the file.</p></li><li><p>Lines 21–23 define a close method that closes the opened file,
          <code>@file</code>.</p></li></ul></section><section id="one1dot2dot2_file_writer_class" data-type="sect2"><h2>11.2.2 FileWriter Class</h2><p>The class in <a href="#filewriter_class" data-type="xref"/> encapsulates
      writing to and closing a file.</p><div id="filewriter_class" data-type="example"><h5>FileWriter class</h5><pre data-type="programlisting" data-code-language="ruby">     1 class FileWriter
     2 	
     3 	def initialize(file_name)
     4 		@file = File.open(file_name, "w")
     5 	end
     6 
     7 	def write_line(output_line)
     8 		@file.puts(output_line)
     9 	end
    10 	
    11 	def close
    12 		@file.close()
    13 	end
    14 end
</pre></div><ul><li><p>Lines 3–5 define the constructor.</p></li><li><p>Line 4 opens the file <code>file_name</code> using <code>w</code> for write access mode.</p></li><li><p>Lines 7–9 define the <code>write_line</code> method, which outputs a single
          line, <span class="keep-together"><code>output_line</code>,</span> to a file associated
          with the <code>FileWriter</code>
          object.</p></li><li><p>Line 8 makes use of the <code>puts</code> method to output the contents of a
          given <span class="keep-together"><code>output_line</code> </span>to the file
          referenced by <code>@file</code>.</p></li><li><p>Lines 11–13 close the file. This ensures that all the data
          that have been written to the file are actually written to it. That
          is, data that are temporarily buffered in intermediate storage are
          actually written to secondary (permanent) storage. Buffering is
          commonly used to reduce output writing delays.</p></li></ul><p>The above use of buffers may seem obscure for a reader who is not
      familiar with the actual mechanisms employed in writing a file. In
      reality, the <code>puts</code> method does not actually write to a
      file; it actually fills a holding area commonly referred to as a
      buffer.</p></section><section id="one1dot2dot3_file_readersoliduswriter_ex" data-type="sect2"><h2>11.2.3 File Reader/Writer Example</h2><p>The code in <a href="#filereadersolidusfilewriter_example" data-type="xref"/>
      will read in a file and write the contents out to a new file. This code
      assumes you have written out the class definitions for <code>FileReader</code> and <span class="keep-together"><code>FileWriter</code>
      </span>given in the preceding section as files named <code data-type="filename">file_reader.rb</code> and <span class="keep-together"><code data-type="filename">file_writer.rb</code>.</span></p><div id="filereadersolidusfilewriter_example" data-type="example"><h5>FileReader/FileWriter example</h5><pre data-type="programlisting" data-code-language="ruby">     1 require_relative "file_reader.rb"
     2 require_relative "file_writer.rb"
     3 
     4 fr = FileReader.new("input.txt")
     5 fw = FileWriter.new("output.txt")
     6 
     7 input = fr.read_file()
     8 fw.write_line(input)
     9 
    10 fw.close()
    11 fr.close()
</pre></div><ul><li><p>Lines 1 and 2 import the class definitions of <code>FileReader</code> and <code>FileWriter</code>.</p></li><li><p>Lines 4 and 5 create instances of our two classes, the first
          for input, the second for output.</p></li><li><p>Line 7 reads the file into a string called <code>input</code>.</p></li><li><p>Line 8 writes the string <code>input</code> out to the file held by the instance
          of <code>FileWriter</code>.</p></li><li><p>Lines 10 and 11 close both of the open files.</p></li></ul><p>To verify that the code presented in <a href="#filereadersolidusfilewriter_example" data-type="xref"/> works correctly, use
      the input text file with the content shown in <a href="#sample_input_file" data-type="xref"/>. After running <a href="#filereadersolidusfilewriter_example" data-type="xref"/>’s code with the input
      from <a href="#sample_input_file" data-type="xref"/>, ensure that <code data-type="filename">output.txt</code> is the same as <code data-type="filename">input.txt</code>.</p><div id="sample_input_file" data-type="example"><h5>Sample input file</h5><pre data-type="programlisting" data-code-language="ruby">    Hello world!
    A mighty fine day for ruby programming!
    Computer Science is the best!

</pre></div></section></section><section id="one1dot3_summary" data-type="sect1"><h1>11.3 Summary</h1><p>We described basic file input and output operations.</p><section id="one1dot3dot1_key_concepts" data-type="sect2"><h2>11.3.1 Key Concepts</h2><ul><li><p>Text files in Ruby are contiguous streams of data in the form
          of characters.</p></li><li><p>Data can be entered into a program using <em>file
          access</em>; this is done through file
          <em>input/output</em> or I/O.</p></li><li><p>To read from or write to a file, one must access the file
          through Ruby’s <code>File</code> class.</p></li></ul></section><section id="one1dot3dot2_key_definitions" data-type="sect2"><h2>11.3.2 Key Definitions</h2><ul><li><p><em>File access</em>: Opening a file for reading
          or writing.</p></li><li><p><em>Input</em>: Reading information from a stored
          file.</p></li><li><p><em>Output</em>: Writing information to a file for
          storage.</p></li></ul></section></section><section id="one1dot4_exercises" data-type="sect1"><h1>11.4 Exercises</h1><ol class="qonly"><li><p>The game of Go is often played online. Many users save their
        game data for later analysis. The game is played by two players who
        take turns placing stones (one player using black stones and the other
        using white stones) on the intersections of a 19 <span> ×</span>
        19 board. Create a program to enter each move of a game and save that
        information to a file.</p></li><li><p>Write a program that quizzes the user on her or his vocabulary.
        Make the program read a set of words and definitions from a file;
        display definitions one at a time, in random order; and prompt for the
        appropriate word.</p></li><li><p>Write a program that will keep track of the mileage for oil
        changes for your car.</p></li><li><p>Write a program that reads the content of a file and outputs it
        to the screen.</p></li><li><p>Write a program that takes input from the user and saves it to a
        file.</p></li><li><p>Write a program that creates and stores a simple address
        book.</p></li></ol></section></section>